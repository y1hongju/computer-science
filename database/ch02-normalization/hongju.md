# Ch 02. Normalization

## 1. 데이터베이스 정규화

### 1-1. 데이터베이스 정규화란?

데이터베이스 정규화란, 관계형 데이터베이스의 설계에서 **데이터의 중복이 최소화 되도록 데이터를 구조화** 하는 프로세스이다. 정규화는 일반적으로 **규모가 비교적 큼과 동시에 조직화가 정교하게 이루어지지 않은 테이블과 그 관계를 비교적 작은 규모로 정교하게 조직화가 이루어진 그것으로 나누는** 프로세스가 포함된다. 정규화의 **정도에 따라** 여러 정규형으로 구분할 수 있으며, 제 1 정규형부터 BCNF를 거쳐 제 6 정규형까지 다양한 정규형이 존재한다. 제 3 정규형을 만족하는 테이블의 대부분이 데이터의 삽입, 변경, 삭제에 대한 **이상(anomaly)이** 없으므로, 비공식적으로 관계형 데이터베이스 테이블(relation)이 제 3 정규화를 만족하면 정규화가 된 것으로 본다. 정규화는 시스템의 특성에 따라 필요가 없는 경우도 있으며, 경우에 따라 **정규화를 하지 않을 때(비정규화) 오히려 더 좋은 성능을** 낼 수도 있다. 데이터 웨어하우스를 디자인 할 때 사용되는 **차원 모델링이** 그 예시이며, **대규모 데이터 시스템 디자인은** 제 3 정규형을 만족하지 않는 경우가 다수 존재한다.

#### 1-1-1. 이상: Anomaly

데이터베이스에서 이상은 **데이터 구조상의 문제점을** 일컫는 용어이다. 데이터베이스 설계가 잘못 되었을 때 **데이터의 중복, 불필요한 데이터 종속성, 데이터 불일치** 등과 같은 문제점이 주로 발생한다. 이상은 데이터의 **무결성과 일관성을** 유지하기 위해 **데이터베이스 설계 단계에서 데이터베이스 정규화를** 통해 제거된다. 다음은 이상의 세 가지 주요 유형이다.

##### 1-1-1-1. 삽입 이상: Insertion Anomaly

**새로운 데이터를 추가할** 때, 의도치 않게 **부가적이거나 관련이 없는 정보를 함께 삽입해야** 하는 경우 발생하는 문제이다. 예를 들어 학생 데이터베이스에 새로 신설될 예정인 과목을 추가하려 할 때, 해당 과목을 수강하는 학생의 정보가 없어 부득이하게 학생 수를 `0`으로 설정하여 저장하는 경우가 이에 해당한다.

##### 1-1-1-2. 삭제 이상: Deletion Anomaly

**데이터의 일부를 삭제할** 때, 의도치 않게 필요한 **다른 데이터까지 함께 삭제되는** 경우 발생하는 문제이다. 예를 들어 어떤 과목의 수강생이 한 명 남아있을 때 해당 수강생이 수강을 취소하여 이 과목에 대한 정보가 데이터베이스에서 완전히 사라지는 경우가 이에 해당한다.

##### 1-1-1-3. 갱신 이상: Update Anomaly

**데이터를 갱신(수정)할** 때, 중복된 데이터로 인해 데이터를 **여러 곳에서 갱신해야** 하고 갱신 작업이 그 일부에서만 이루어지고 일관성이 깨져 **데이터가 불일치 되는 경우** 발생하는 문제이다. 예를 들어 한 학생의 주소가 여러 곳에 중복되어 저장되어 있을 경우, 학생이 주소를 변경할 때마다 **주소가 저장된 모든 위치를 찾아** 모두 완벽하게 갱신하지 않으면 데이터 불일치 문제가 발생할 수 있다.

### 1-2. 정규화의 목적

데이터베이스 정규화의 목표는 이상이 있는 관계(relation)를 재구성하여 작고 정교하게 조직된 관계를 생성하는 것에 있다. 또한 하나의 테이블에서의 데이터의 삽입, 삭제, 변경이 정의된 관계들로 인하여 데이터베이스의 다른 요소에도 동일하게 적용될 수 있도록 하는 것이다.

### 1-3. 제 1 정규형: 1NF

제 1 정규화는 데이터베이스 정규화 과정 중 첫 번째 단계이다. 정규화는 데이터베이스 설계를 개선하기 위해 데이터를 구조화하는 과정으로, 데이터의 중복을 최소화하여 그 무결성과 일관성을 유지하는 것을 목표로 한다. 이 과정에서 제 1 정규화는 가장 중요한 첫 번째 단계이며, 모든 필드의 값이 원자값(atomic value)이 되도록 하는 것이 주요 목표이다. 이는 각 필드에 여러 개의 값이 올 수 없음을 의미하며 하나의 필드는 오직 하나의 값만을 가진다는 의미이다. 또한 각 테이블의 각 튜플이 Primary Key에 의해 고유하게 식별될 수 있어야 한다. 아래 예시는 제 1 정규형을 만족하지 않는 테이블이다.

| book_id | book_name | author       |
| ------- | --------- | ------------ |
| 1       | 홍길동전  | 허균, 홍길동 |

위 테이블에서 `author` 정보를 별도의 테이블로 분리하여 제 1 정규형을 만족하도록 다음과 같이 재구성할 수 있다.

| book_id | book_name |
| ------- | --------- |
| 1       | 홍길동전  |

| author_id | author_name | book_id |
| --------- | ----------- | ------- |
| 1         | 허균        | 1       |
| 2         | 홍길동      | 1       |

제 1 정규화는 데이터의 중복을 제거하고 데이터베이스에서 발생할 수 있는 다양한 이상을 방지하는 데 중요한 역할을 하며, 각 필드의 데이터를 원자값으로 분해함으로써 데이터의 무결성을 향상시키고 효율적인 데이터 관리와 활용이 가능하게 한다.

### 1-4. 제 2 정규형: 2NF

데이터베이스의 제 2 정규형은 제 1 정규형의 다음 단계로 데이터의 무결성을 보장하고 중복을 줄이기 위해 수행된다. 2NF에 이르기 위해서는 먼저 1NF를 충족해야 한다. 제 2 정규화의 주요 목표는 부분적 종속성을 제거하는 것이다. 이는 테이블의 기본 키가 두 개 이상의 열로 구성된 복합 키일 때, 테이블의 일부 속성이 기본 키 전체가 아닌 그 일부분에만 종속되는 현상을 일컫는다. 아래는 대학교 수강 정보를 활용한 예시이다.

| student_id | subject_code | register_date | professor |
| ---------- | ------------ | ------------- | --------- |
| s1         | c1           | 2024-03-01    | 홍길동    |
| s2         | c1           | 2024-03-02    | 홍길동    |
| s3         | c2           | 2024-03-01    | 박덕팔    |

이 테이블의 `professor` 속성이 `subject_code`에 종속되므로 제 2 정규형을 만족하지 않는다. `professor` 정보가 불필요하게 중복되므로 다음과 같이 별도의 과목 테이블을 만들어 제 2 정규형을 만족시킬 수 있다.

| student_id | subject_code | register_date |
| ---------- | ------------ | ------------- |
| s1         | c1           | 2024-03-01    |
| s2         | c1           | 2024-03-02    |
| s3         | c2           | 2024-03-01    |

| subject_code | professor |
| ------------ | --------- |
| c1           | 홍길동    |
| c2           | 박덕팔    |

### 1-5. 제 3 정규형: 3NF

데이터베이스의 제 3 정규형은 제 2 정규형의 다음 단계로, 제 1 정규형과 제 2 정규형을 모두 만족해야 한다. 제 3 정규형은 이행적 종속(transitive dependency)을 제거하는 것을 주요 목표로 한다. 이는 비기본키(non-primary key) 필드가 오로지 기본키에만 종속되어야 함을 뜻한다. 예를 들어 F1이 F2에 종속되고 F2가 F3에 종속되어 F1이 F3에 간접적으로 종속된다면, 이는 제 3 정규형을 만족하지 않는 경우이다. 다음은 고객 정보 데이터를 활용한 예시이다.

| customer_id | customer_name | customer_gender | order_id | order_date | order_prod |
| ----------- | ------------- | --------------- | -------- | ---------- | ---------- |
| c1          | 홍길동        | 남              | o1       | 2024-03-01 | 바나나     |
| c2          | 양태경        | 남              | o2       | 2024-03-02 | 맥북       |

이를 아래와 같이 분해하여 `order_date`와 `order_prod가` `customer_id에` 간접적으로 종속되지 않도록 할 수 있다.

| customer_id | customer_name | customer_gender |
| ----------- | ------------- | --------------- |
| c1          | 홍길동        | 남              |
| c2          | 양태경        | 남              |

| order_id | order_prod |
| -------- | ---------- |
| o1       | 바나나     |
| o2       | 맥북       |

| order_id | customer_id | order_date |
| -------- | ----------- | ---------- |
| o1       | c1          | 2024-03-01 |
| o2       | c2          | 2024-03-02 |
