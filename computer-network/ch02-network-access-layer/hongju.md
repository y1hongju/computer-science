# Ch 02. Network Access Layer

- OSI 모델의 1계층과 2계층에 대응되는 계층
- `[주의]` **동일**이 아닌 **유사**의 개념
- LAN 환경에서 데이터를 주고받는 규칙이 주로 정의되어 있는 계층

## 1. 이더넷

### 1-1. 이더넷이란?

- LAN에서 (특히 유선 LAN)에서의 사실상 표준인 기술
- 근거리 호스트들끼리 통신할 때 사용되는 \*통신매체와 \*\*정보의 형식을 정의한 개념
  - \*네트워크 케이블 스펙 등
  - \*\*프로토콜 등
- WAN에서의 대표적인 기술은 인터넷과는 다른 개념 (Internet $\neq$ Ethernet)

### 1-2. 이더넷 케이블

- 물리 계층에서 **이더넷 케이블**이, 데이터 링크 계층에서는 **이더넷 프레임**이 사용됨
- IEEE 802.3 Ethernet Working Group에 의해 아직까지도 발전 중인 기술
- 표준 규격으로 **IEEE 802.3 시리즈**를 정의하고 `802.3{알파벳}`으로 표기
  - e.g., `802.3ab`, `802.3u`
- 규격별로 전송 속도, 연결매체 종류 등이 다르게 정의되어 있음
- 케이블을 지칭할 때에는 `802.3{알파벳}` 표기보다 `{전송속도}{BASE}-{추가특성}` 표기를 사용
  - e.g., `10BASE-T`, `25GBASE-LR`
  - `BASE`는 기본 대역(baseband) 통신을 사용하고, 이는 전송 매체를 통해 하나의 데이터 신호만 전송될 수 있음을 의미 (전송 채널 전체를 사용하고 단일 데이터 신호를 전송)
  - 대표적인 `추가특성`으로 케이블의 종류가 있음
    - `L`: 광케이블
    - `TP` or `T`: 구리 케이블
    - `C`: 동축 케이블
- 고성능 하드웨어, 알고리즘을 사용하더라도 케이블이 성능을 받쳐주지 못한다면 병목이 발생할 수 있음

### 1-3. Network Interface Card

- 호스트를 네트워크에 연결하기 위한 하드웨어
- 연결(통신) 매체를 통해 전달받은 신호를 호스트가 해석할 수 있도록 변환하고 전달하는 하드웨어
  - 반대 방향으로의 변환 및 전달 작업도 수행 (호스트 $\rightarrow$ 연결매체)
- 과거 PCB에서 현재는 USB 드라이브나 메인보드에 내장되는 등의 형태로 존재
- `100/100 Mbps` 처럼 수신/송신 속도를 표기
- 이더넷 케이블과 마찬가지로 NIC의 성능이 낮으면 시스템 병목 현상이 발생할 수 있음

### 1-4. 이더넷 프레임

- 데이터 링크 계층에서의 이더넷 기술
- LAN 환경에서의 호스트들끼리 데이터를 주고 받을 때 사용
- `헤더 / 페이로드 / 트레일러` 로 구성 [_구성표_](https://en.wikipedia.org/wiki/Ethernet_frame#Structure)
  - `페이로드`는 상위 계층인 network layer로부터 전달받은 데이터 (캡슐화된 데이터)

#### 1-4-1. 이더넷 프레임 헤더: 프리앰블

- `8Bytes` 길이
- 이더넷 프레임의 시작을 알리는 비트열
- 송/수신 간의 동기화 (속도를 맞추기 위한 타이밍 조정 등)
- 첫 7바이트는 `10101010`
- 마지막 1바이트는 `10101011` (SFD; Start Frame Delimiter)

#### 1-4-2. 이더넷 프레임 헤더: 목적지/송신지 MAC 주소

- 각 `6Bytes` 길이
- NIC의 고유한 식별자인 \*MAC 주소에 대한 정보
  - \*일반적으로 고유하고 변경이 불가능하며, 물리적 주소라고도 부름
- 리눅스 OS에선 `ifconfig` 커맨드로 확인할 수 있음
- 전달받은 프레임의 헤더에 있는 목적지 MAC 주소를 보고 나와 일치하지 않으면 프레임을 폐기

#### 1-4-3. 이더넷 프레임 헤더: 이더타입 or 길이

- `2Bytes` 길이
- 값이 `1536` 이상인 경우에는 [이더타입](https://en.wikipedia.org/wiki/EtherType)을, `1500` 이하인 경우에는 프레임의 크기를 의미
  - 같은 이더넷 프레임이더라도 [다양한 형식](https://en.wikipedia.org/wiki/Ethernet_frame#Types)이 존재하는 것으로 보임

#### 1-4-4. 이더넷 프레임 페이로드

- Ethernet II 타입 기준, `46 ~ 1500Bytes` 길이
- 상위 계층인 네트워크 계층으로부터 전달받은 운반할 데이터

#### 1-4-5. 이더넷 프레임 트레일러

- Frame Check Sequence
- `4Bytes` 길이
- 오류 검출을 위한 CRC 값이 명시되는 필드
- 송신지에서 계산된 CRC 값과 수신지에서 계산한 값을 비교
  - 값이 다르면 데이터가 손상되었을 가능성이 높으므로 해당 프레임은 폐기

##### 1-4-5-1. CRC

- Cyclic Redundancy Check
- 체크섬 알고리즘의 한 종류
- 네트워크, 데이터베이스 등에서 데이터의 유효성을 검증하기 위해 사용
- 데이터를 긴 이진수로 간주하고 이를 \*사전에 정의한 다항식으로 나눈 나머지 값을 활용
  - \*이더넷, ZIP, GZIP, PNG 등에서는 `0x04C11DB7`를 다항식으로 사용하는 [CRC-32](https://en.wikipedia.org/wiki/Cyclic_redundancy_check#Polynomial_representations)를 사용

## 2. 허브와 CSMA/CD

### 2-1. 허브 (Hub)

#### 2-1-1. 반이중/전이중 통신

- Half-duplex, full-duplex
- 송신과 수신이 동시에 이루어질 수 있느냐를 구분하는 개념
- 이더넷 허브는 반이중 통신으로 동작하고, \*이 외의 네트워크 장비들은 일반적으로 전이중 통신을 지원
  - \*대표적으로 후술할 [스위치(L2)](#3-1-스위치)가 있음

#### 2-1-2. 허브란?

- 물리 계층에서 사용되며 주소 개념이 없는 하드웨어
  - **주소** 개념이 없기 때문에 전달 받은 메시지를 모든 호스트에 전달 (**브로드캐스팅**)
  - `[주의]` MAC 주소를 사용하지 않음 (데이터 링크 계층에서 사용)
- 주로 이더넷 허브 또는 \*더미 허브라고 부름
  - \*데이터 처리나 패킷 라우팅 등의 복잡한 연산을 하지 않기 때문
- 오늘날에는 잘 사용되지 않고 데이터 링크 계층 이상의 장비가 주로 사용됨
  - 단, CSMA/CD 프로토콜과 반이중/전이중 개념을 습득하기에 좋은 장비
- 호스트를 연결할 수 있는 다수의 포트(port)가 존재
- 전이중이 아닌 **반이중** 통신으로 동작
- 허브에 대비되는 네트워크 장비로 [스위치(L2)](#3-1-스위치)가 있음
  - 전달받은 신호를 목적지 포트로만 보냄 (MAC 주소 활용)
  - 전이중 통신 지원
  - 데이터 링크 계층에서 사용

### 2-2. CSMA/CD

- 이더넷 허브의 반이중 통신에서 발생하는 \*충돌 문제를 해결하기 위한 프로토콜
  - \*둘 이상의 장치(호스트)가 동시에 허브로 데이터를 전송할 경우 충돌(collision)이 발생
- 충돌이 발생할 수 있는 장치의 범위를 collision domain이라 칭함
  - 이더넷 허브의 포트에 연결되어 있는 모든 호스트 등

#### 2-2-1. CSMA

- Carrier Sense: 캐리어(반송파) 감지
  - 메시지를 전송하기 전에 현재 전송 중인 메시지가 있는지 확인
- Multiple Access: 다중 접근
  - 두 개 이상의 호스트가 동시에 네트워크에 접근할 수 있음을 나타내는 개념
  - 특정 네트워크 자원을 여러 사용자나 장치가 공유할 수 있음을 의미

#### 2-2-2. CD

- Collision Detection: 충돌 감지
  - 캐리어 감지가 이루어졌는데도 불구하고 충돌이 발생한 경우 이를 해결하기 위한 방법
  - 잼 신호(jam signal)를 보낸 뒤에 임의의 시간 동안 대기한 후에 메시지를 재전송
    - 송신 주체: 데이터를 전송하다가 충돌을 감지한 장치(호스트 등)
    - 수신 주체: Collision domain에 속한 모든 장치

## 3. 스위치와 VLAN

### 3-1. 스위치 (L2 스위치)

- 전달 받은 신호를 특정 목적지 포트로만 내보내는 \*데이터 링크 계층의 네트워크 장비
  - \*따라서 MAC 주소를 사용할 수 있고 이를 위한 [MAC 주소 학습 기능](#3-1-1-mac-주소-학습-기능)이 존재
- 장비에 연결된 모든 호스트가 아닌 목적지 호스트만이 collision domain에 속함
- 전이중 통신으로 동작하여 [CSMA/CD](#2-2-csmacd) 프로토콜이 필요하지 않음

#### 3-1-1. MAC 주소 학습 기능

- 임의의 포트 번호와 이에 연결된 호스트의 MAC 주소 관계 정보를 기억하는 기능
- 포트 번호와 호스트의 MAC 주소를 테이블 형태로 관리하며 이를 `MAC 주소 테이블`이라고 칭함

#### 3-1-2. MAC 주소 학습 과정

##### 3-1-2-1. 플러딩 (Flooding)

- 마치 이더넷 허브 처럼 스위치의 모든 포트로 이더넷 프레임을 전송하는 것 (브로드캐스팅)
- 송신지 MAC 주소를 기반으로 동작

1. 포트 P1에 연결된 호스트 H1이 스위치에 메시지를 송신
1. MAC 주소 테이블에 포트 번호(P1)와 MAC 주소(H1) 정보를 기록
1. 송신된 프레임을 어떤 포트로 내보내야 할 지 아직 모르는 상태이므로 프레임을 모든 포트로 내보냄
1. 목적지 주소에 해당하는 호스트(H2)만이 요청에 응답하고 다른 호스트는 프레임을 자동으로 폐기
1. 요청에 응답한 호스트와 연결된 포트 번호(P2) 정보를 MAC 주소 테이블에 기록

##### 3-1-2-2. 포워딩과 필터링

- 포워딩: 학습된 MAC 주소 테이블에 정보가 있는 호스트가 수신해야 하는 프레임이 전달되면 이를 해당하는 호스트에게만 송신하는 것
- 필터링: 목적지 주소와 관계 없는 다른 호스트에게는 프레임을 송신하지 않는 것

##### 3-1-2-3. 에이징

- 특정 시간이 지나면 MAC 주소 테이블의 항목을 삭제하는 것
- 특정 포트의 호스트가 변경되었을 수 있으므로 반드시 필요한 기능

### 3-2. VLAN

- 이더넷 스위치를 통해 구현할 수 있는 대표적인 기능
- 물리적 위치에 관계 없이 호스트를 가상의 특정 LAN에 속하도록 하는 것
- 플러딩 단계에서의 불필요한 비효율(브로드캐스팅)을 막고 트래픽을 감소시키는 효과
- 만약 어떤 호스트가 다른 VLAN에 속한 임의의 호스트에 메시지를 전송하려는 경우 네트워크 계층 이상의 장비가 필요
  - 같은 스위치에 연결되어 있더라도 네트워크 계층 이상의 장비가 없다면 메시지를 전송할 수 없음
  - 네트워크 계층 이상의 대표적인 장비로 **라우터**가 있음

#### 3-2-1. 정적 VLAN

- 물리적 포트를 기반으로 임의의 VLAN을 구성하는 방법

#### 3-2-2. 동적 VLAN

- MAC 주소를 기반으로 임의의 VLAN을 구성하는 방법
- 임의의 MAC 주소와 매핑되는 VLAN 정보를 테이블 형태로 관리
