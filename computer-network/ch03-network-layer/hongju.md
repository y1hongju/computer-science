# Ch 03. Network Layer

- 물리 계층과 데이터 링크 계층은 LAN에 국한된 계층
  - 단, '이더넷'으로 WAN 통신이 불가능한 것은 아님
- 본 계층은 **LAN 간의 통신**을 가능하게 해주는 계층
- IP 환경에서의 패킷 단편화(fragmentation)가 이루어지는 계층

## 1. IP (Internet Protocol)

- 네트워크 계층의 가장 중요한 프로토콜
- 네트워크 계층을 학습한다는 것은 사실상 IP를 학습하는 것과 같음
- **라우팅**을 통해 네트워크간 통신이 가능하게 함
  - 이를 위한 네트워크 장비가 **라우터**
- 현재 주로 사용되는 IPv4와 나중을 위한 IPv6가 있음

### 1-1. IP 주소

- MAC 주소가 있음에도 IP 주소가 필요함
- 하위 계층인 데이터 링크 계층에 MAC 주소로는 라우팅이 어려움
- 또한 임의의 LAN에 속한 호스트의 MAC 주소를 일일히 기억하기가 어려움
- 사람으로 치면 MAC 주소는 주민등록번호, IP 주소는 거주지 주소 개념
- 실제 통신 시에는 MAC 주소와 IP 주소가 동시에 사용
- 동일한 LAN에서 통신할 때 이론적으로 MAC 주소 정보만 있어도 되지만 IP 주소가 우선적으로 사용됨

#### 1-1-1. IPv4 주소 표현

- 4바이트로 표현 가능
- 하나의 옥텟을 0~255 범위의 십진수로 표기
- 이론적으로 할당 가능한 주소의 갯수는 $2^{32}$개
- IP 주소 고갈 문제가 있어 [IPv6](#1-1-2-ipv6)가 고안되었으나 NAT 기술로 아직 고갈 되지 않았음

#### 1-1-2. IPv6

- 16바이트로 표현 가능
- 이론적으로 할당 가능한 주소의 갯수는 $2^{128}$개 $\Rightarrow$ 사실상 무한

### 1-2. IP의 두 가지 주요 기능

- 주소 지정
  - IP 주소는 직접 할당할 수도 있고 DHCP 같은 프로토콜을 사용하여 자동으로 할당되게 할 수도 있음
- 단편화
  - 데이터를 패킷 단위로 잘게 쪼개는 것
  - 패킷의 크기는 MTU(Maximum Transmission Unit) 이하로 유지
    - 리눅스 환경에서 `ifconfig` 커맨드로 MTU 크기를 확인할 수 있음
  - 단편화된 패킷들은 목적지에서 재조합 됨
- MTU 크기
  - 크기를 작게 설정하면 전송률이 올라가지만, 단편화 오버헤드 비용이 증가하는 단점
  - 크기를 크게 설정하면 단편화 오버헤드 비용이 감소하지만, 네트워크의 throughput이 양호하지 않은 경우 패킷이 유실될 확률이 높아지는 단점

### 1-3. IPv4 헤더

#### 1-3-1. 식별자, 플래그, 단편화 오프셋

- 단편화 단계에서 주로 사용되는 필드

##### 1-3-1-1. 식별자

- 재조합 시 사용되는 패킷에 할당된 번호
- 어떤 데이터가 단편화 된 것인지 식별하기 위함

##### 1-3-1-2. 플래그

- 미사용, Don't Fragment, More Fragment 같은 부가 정보가 담기는 필드
- 미사용인 경우 값은 항상 0임

##### 1-3-1-3. 단편화 오프셋

- 패킷이 데이터의 시작점부터 얼마나 떨어져 있는지에 대한 정보를 담는 필드

#### 1-3-2. TTL, 프로토콜, 헤더 체크섬

##### 1-3-2-1. TTL

- Time To Live의 약자
- 패킷의 수명을 나타내며 라우터를 거칠 때마다 1씩 감소
- 패킷이 라우팅 순혼 루프에 빠지는 경우 패킷을 소멸시키기 위한 정보

##### 1-3-2-2. 프로토콜

- TCP, UDP등 상위 계층(전송 계층)에서 사용된 프로토콜에 대한 정보

#### 1-3-3. 송신/목적지 IP 주소

- `192.168.0.1` 같은 IPv4 주소 값이 담기는 필드
- IP 주소 지정 기능이 선행되어야 함

### 1-4. IPv6 헤더

#### 1-4-1. 송신/목적지 IP 주소

- `0000:aaaa:bbbb:3333:1234:ffff:0000:2asd` 같은 IPv6 주소 값이 담기는 필드
- 각 16바이트(128비트)의 크기
- ...

## 2. ARP

## 3. ICMP

## 4. IP 주소

## 5. IP 주소의 분류

## 6. 라우팅
